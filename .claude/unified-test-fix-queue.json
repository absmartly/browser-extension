{
  "queueVersion": "3.0",
  "created": "2025-10-28",
  "campaign": "Complete Test Suite Remediation - E2E + Unit Tests",
  "totalTasks": 14,
  "executionStrategy": "Agents autonomously pick tasks from queue. No dependencies - all tasks can run in parallel.",
  "instructions": "Each agent: (1) Read this file, (2) Pick next 'pending' task, (3) Change status to 'in_progress', (4) Execute task, (5) Change status to 'completed', (6) Report results",
  "tasks": [
    {
      "id": "unit-fix-1",
      "type": "unit-test-fix",
      "priority": "P0",
      "status": "completed",
      "title": "Fix messaging module exports",
      "files": [
        "src/lib/messaging.ts",
        "src/lib/__tests__/messaging.test.ts",
        "background/core/__tests__/message-router.test.ts"
      ],
      "issue": "Module has no exported member 'ExtensionMessage', 'sendMessage', 'setupMessageResponseHandler'",
      "action": "Read messaging.ts, check what needs exporting, export missing types/functions or update tests to match new API",
      "test_command": "npm run test:unit -- messaging.test.ts && npm run test:unit -- message-router.test.ts",
      "expected_outcome": "Tests compile without TypeScript errors",
      "estimated_minutes": 20,
      "completed_at": "2025-10-28T20:54:00Z",
      "agent": "Agent 6",
      "result": "All exports already present. Tests passing: messaging.test.ts (13 passed), message-router.test.ts (21 passed). No changes needed.",
      "completed_notes": "Tests already passing - messaging module exports are correct and all tests compile without errors",
      "completion_notes": "Already resolved - all required exports present (ExtensionMessage, sendMessage, setupMessageResponseHandler). Tests pass: messaging.test.ts (13 tests) and message-router.test.ts (21 tests). No TypeScript errors."
    },
    {
      "id": "unit-fix-2",
      "type": "unit-test-fix",
      "priority": "P0",
      "status": "completed",
      "title": "Fix visual-editor isActive read-only property",
      "files": [
        "src/visual-editor/core/visual-editor.ts",
        "src/visual-editor/core/__tests__/visual-editor.test.ts"
      ],
      "issue": "Cannot assign to 'isActive' because it is a read-only property (lines 271, 790)",
      "action": "Either make isActive settable OR refactor tests at lines 271 and 790 to use public methods instead of direct property mutation",
      "test_command": "npm run test:unit -- visual-editor.test.ts",
      "expected_outcome": "Test file compiles without TypeScript errors",
      "estimated_minutes": 25,
      "started_at": "2025-10-28T20:48:04.213Z",
      "agent": "Agent 2",
      "completed_at": "2025-10-28T20:51:17.946Z",
      "result": "Added hideToolbar() and showToolbar() methods to UIComponents class. All 49 tests passing."
    },
    {
      "id": "unit-fix-3",
      "type": "unit-test-fix",
      "priority": "P0",
      "status": "completed",
      "title": "Add PreviewManager javascript validation",
      "files": [
        "src/visual-editor/preview/preview-manager.ts"
      ],
      "issue": "applyPreviewChange() doesn't validate javascript action - missing 'value' check and type check",
      "action": "Add validation in applyPreviewChange(): if action === 'javascript', check value exists and is string, return false if not",
      "test_command": "npm run test:unit -- preview-manager.test.ts",
      "expected_outcome": "2 tests pass: 'should return false for javascript with missing value' and 'should return false for javascript with non-string value'",
      "estimated_minutes": 20,
      "started_at": "2025-10-28T20:55:00Z",
      "agent": "Agent 6",
      "completed_at": "2025-10-28T21:00:00Z",
      "result": "Added javascript validation before element processing. All 37 tests passing (2 failures fixed). File: src/sdk-bridge/dom/preview-manager.ts"
    },
    {
      "id": "unit-fix-4",
      "type": "unit-test-fix",
      "priority": "P1",
      "status": "completed",
      "title": "Fix EventsDebugPage click handler",
      "files": [
        "src/components/__tests__/EventsDebugPage.test.tsx"
      ],
      "issue": "mockTabsSendMessage never called when event is clicked (3 tests fail)",
      "action": "Review test setup, fix click simulation (may need waitFor(), different click method, or mock adjustment)",
      "test_command": "npm run test:unit -- EventsDebugPage.test.tsx",
      "expected_outcome": "3 tests pass: 'opens event viewer when event is clicked', 'sends correct data for event with null data', 'opens event viewer for different events'",
      "estimated_minutes": 25,
      "completed_notes": "Tests already fixed and passing. Changed closest(\"div\") to closest(\"[data-testid=\\\"event-item\\\"]\") to properly target event container. All 19 tests pass.",
      "commit": "86a0f797"
    },
    {
      "id": "unit-fix-5",
      "type": "unit-test-fix",
      "priority": "P2",
      "status": "completed",
      "title": "Fix or document CodeExecutor eval prevention",
      "files": [
        "src/sdk-bridge/experiment/code-executor.ts",
        "src/sdk-bridge/__tests__/experiment/code-executor.test.ts"
      ],
      "issue": "Test expects eval() to be prevented but it's not (line 135)",
      "action": "Research if eval prevention is possible in Function constructor context. Either implement prevention OR document as architectural limitation and skip test with clear comment",
      "test_command": "npm run test:unit -- code-executor.test.ts",
      "expected_outcome": "Either test passes (eval prevented) OR test skipped with documentation explaining why prevention isn't feasible",
      "estimated_minutes": 30,
      "completion_notes": "Test skipped with comprehensive documentation explaining architectural limitation. Cannot prevent eval() in Function constructor context - this is a fundamental JavaScript limitation. The validate() method warns about eval patterns, and code only executes in preview mode. Tests pass: 1 skipped, 20 passed, 21 total."
    },
    {
      "id": "unit-fix-6",
      "type": "unit-test-fix",
      "priority": "P2",
      "status": "completed",
      "title": "Fix Manifest HTTPS security check",
      "files": [
        "Find manifest validation test file (likely in tests/ or src/)"
      ],
      "issue": "Test expects all host_permissions to be https:// but manifest includes http://localhost/* for local dev",
      "action": "Find manifest test, add exception for localhost: if (permission !== 'http://localhost/*') { expect(permission).toMatch(/^https:\\/\\//) }",
      "test_command": "npm run test:unit -- manifest.test.ts (or appropriate file)",
      "expected_outcome": "Manifest HTTPS test passes with localhost exception",
      "estimated_minutes": 15,
      "started_at": "2025-10-28T21:02:00Z",
      "agent": "Agent 6",
      "completed_at": "2025-10-28T21:05:00Z",
      "result": "Added localhost exception to HTTPS check. All 29 tests passing (1 failure fixed). File: src/__tests__/manifest-permissions.test.ts"
    },
    {
      "id": "unit-verify",
      "type": "unit-test-verification",
      "priority": "P0",
      "status": "in_progress",
      "title": "Full unit test suite verification",
      "files": [
        "All unit test files"
      ],
      "issue": "After fixes, verify all 1319 unit tests pass",
      "action": "Run complete unit test suite, capture output, compare with baseline (7 failed \u2192 0 failed)",
      "test_command": "npm run test:unit 2>&1 | tee .claude/unit-test-results-after-fix.txt",
      "expected_outcome": "0 failed, 1319 passed, 100% pass rate",
      "estimated_minutes": 15
    },
    {
      "id": "e2e-skip-fix-1",
      "type": "e2e-test-fix",
      "priority": "P0",
      "status": "completed",
      "title": "Remove erroneous skip from visual-editor-unified",
      "files": [
        "tests/e2e/visual-editor-unified.spec.ts"
      ],
      "issue": "Lines 126-141 have erroneous test.skip() when 'No experiments found' appears (16 lines to remove)",
      "action": "Read file, locate skip block around lines 126-141 that checks for 'No experiments found' text, remove entire block",
      "test_command": "npx playwright test tests/e2e/visual-editor-unified.spec.ts",
      "expected_outcome": "Test runs without skipping on missing experiments (may fail, which is correct)",
      "estimated_minutes": 15,
      "note": "This task may already be completed - check git log first",
      "started_at": "2025-10-28T20:52:19.091Z",
      "agent": "Agent 2",
      "completed_at": "2025-10-28T20:52:57.247Z",
      "result": "Already completed in commit e0204c56. No erroneous skips found in visual-editor-unified.spec.ts."
    },
    {
      "id": "e2e-skip-scan",
      "type": "e2e-test-fix",
      "priority": "P0",
      "status": "in_progress",
      "title": "Scan and remove all erroneous no-experiments skips",
      "files": [
        "tests/e2e/*.spec.ts"
      ],
      "issue": "Multiple test files may contain same erroneous skip pattern from previous agents",
      "action": "Search: grep -r 'test.skip()' tests/e2e/ --include='*.spec.ts', check each for 'No experiments found' check, remove erroneous blocks",
      "test_command": "For each file fixed, run: npx playwright test tests/e2e/[filename]",
      "expected_outcome": "All blanket 'no experiments' skips removed. Report list of files fixed.",
      "estimated_minutes": 30
    },
    {
      "id": "e2e-skip-doc",
      "type": "e2e-test-documentation",
      "priority": "P0",
      "status": "in_progress",
      "title": "Document all remaining skip() calls",
      "files": [
        "All test files with skip() calls"
      ],
      "issue": "After erroneous skips removed, legitimate skips need documentation",
      "action": "Find all test.skip() calls, classify as LEGITIMATE (environmental) or SUSPICIOUS (data-based), add comments explaining why",
      "test_command": "grep -r 'test.skip' tests/e2e/ and review each",
      "expected_outcome": "All remaining skips have clear documented reasons",
      "estimated_minutes": 25
    },
    {
      "id": "e2e-verify-1",
      "type": "e2e-test-verification",
      "priority": "P1",
      "status": "pending",
      "title": "Verify visual-editor-simple test",
      "files": [
        "tests/e2e/visual-editor-simple.spec.ts"
      ],
      "issue": "This file had erroneous skip removed - verify it runs correctly",
      "action": "Build extension: npm run build:dev, then run: npx playwright test tests/e2e/visual-editor-simple.spec.ts",
      "test_command": "npm run build:dev && npx playwright test tests/e2e/visual-editor-simple.spec.ts",
      "expected_outcome": "Test runs without skipping. Document pass/fail/skip counts.",
      "estimated_minutes": 10,
      "note": "This fix may already be completed - check git log first"
    },
    {
      "id": "e2e-verify-2",
      "type": "e2e-test-verification",
      "priority": "P1",
      "status": "pending",
      "title": "Verify visual-editor-demo and visual-editor-summary tests",
      "files": [
        "tests/e2e/visual-editor-demo.spec.ts",
        "tests/e2e/visual-editor-summary.spec.ts"
      ],
      "issue": "These files had erroneous skips removed - verify they run",
      "action": "Build extension: npm run build:dev, then run both tests",
      "test_command": "npm run build:dev && npx playwright test tests/e2e/visual-editor-demo.spec.ts tests/e2e/visual-editor-summary.spec.ts",
      "expected_outcome": "Both tests run without skipping. Document results for each.",
      "estimated_minutes": 15,
      "note": "These fixes may already be completed - check git log first"
    },
    {
      "id": "e2e-verify-3",
      "type": "e2e-test-verification",
      "priority": "P1",
      "status": "pending",
      "title": "Verify visual-editor-unified test",
      "files": [
        "tests/e2e/visual-editor-unified.spec.ts"
      ],
      "issue": "Verify skip removal worked correctly",
      "action": "Build extension: npm run build:dev, then run: npx playwright test tests/e2e/visual-editor-unified.spec.ts",
      "test_command": "npm run build:dev && npx playwright test tests/e2e/visual-editor-unified.spec.ts",
      "expected_outcome": "Test runs correctly without erroneous skip logic",
      "estimated_minutes": 10
    },
    {
      "id": "e2e-verify-full",
      "type": "e2e-test-verification",
      "priority": "P0",
      "status": "pending",
      "title": "Full E2E test suite verification",
      "files": [
        "tests/e2e/ (all tests)"
      ],
      "issue": "After all fixes, verify overall E2E test suite health",
      "action": "Build extension: npm run build:dev, run full suite: npx playwright test tests/e2e/ --reporter=list 2>&1 | tee .claude/e2e-test-results-after-fix.txt",
      "test_command": "npm run build:dev && npx playwright test tests/e2e/ --reporter=list",
      "expected_outcome": "Capture full results: total/passed/failed/skipped. Compare with pre-fix numbers. Document NEW failures (bugs that were hidden).",
      "estimated_minutes": 40
    }
  ],
  "summary": {
    "unit_tests": {
      "total_fixes": 6,
      "verification": 1,
      "baseline": "7 failed, 1312 passed (99.5%)",
      "target": "0 failed, 1319 passed (100%)"
    },
    "e2e_tests": {
      "total_fixes": 3,
      "documentation": 1,
      "verification": 4,
      "baseline": "4 files with 44 lines of erroneous skip logic",
      "target": "All erroneous skips removed, legitimate skips documented"
    },
    "total_estimated_time": "~5-6 hours for all tasks"
  }
}
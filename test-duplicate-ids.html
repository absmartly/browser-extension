<!DOCTYPE html>
<html>
<head>
  <title>Duplicate IDs Test</title>
</head>
<body>
  <!-- Container with unique ID -->
  <div id="bhp-ab-gateway-desktop-atf-4">
    <div>
      <div>
        <div>
          <div>
            <!-- First item with duplicate ID -->
            <a>
              <div id="bnp-recs-card-title">
                <span>First item text</span>
              </div>
            </a>
            <!-- Second item with duplicate ID -->
            <a>
              <div id="bnp-recs-card-title">
                <span>Second item text</span>
              </div>
            </a>
            <!-- Third item with duplicate ID -->
            <a>
              <div id="bnp-recs-card-title">
                <span>Third item text</span>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Copy the updated getSelector function from background.ts
    function getSelector(element) {
      // This would be the actual function from background.ts
      // For testing, we'll just log what selector we would generate
      console.log('Testing selector for:', element.textContent)

      // Simplified version to demonstrate the concept
      if (element.id && element.id === 'bnp-recs-card-title') {
        // Find parent with unique ID
        let parent = element
        while (parent && parent.id !== 'bhp-ab-gateway-desktop-atf-4') {
          parent = parent.parentElement
        }

        if (parent) {
          // Try minimal selector
          const testSelector = '#bhp-ab-gateway-desktop-atf-4 #bnp-recs-card-title'
          const matches = document.querySelectorAll(testSelector)

          if (matches.length > 1) {
            // Need more specificity
            console.log('Selector matches', matches.length, 'elements, need parent context or nth-child')

            // Get position among siblings
            const siblings = Array.from(element.parentElement.parentElement.children)
            const index = siblings.indexOf(element.parentElement) + 1

            return '#bhp-ab-gateway-desktop-atf-4 a:nth-child(' + index + ') > #bnp-recs-card-title'
          }

          return testSelector
        }
      }

      return 'span' // fallback
    }

    function testSelectors() {
      console.log('=== Testing Duplicate ID Handling ===\n')

      // Get all elements with duplicate IDs
      const duplicateIdElements = document.querySelectorAll('#bnp-recs-card-title')
      console.log('Found', duplicateIdElements.length, 'elements with ID "bnp-recs-card-title"\n')

      duplicateIdElements.forEach((elem, index) => {
        const span = elem.querySelector('span')
        console.log('Element', index + 1, ':', span.textContent)

        // What we want:
        // Instead of: #bhp-ab-gateway-desktop-atf-4 > div > div > div > div > a:nth-child(1) > div > span
        // We want:    #bhp-ab-gateway-desktop-atf-4 a:nth-child(1) > #bnp-recs-card-title > span
        // Or better:  #bhp-ab-gateway-desktop-atf-4 #bnp-recs-card-title:nth-child(1) > span

        const idealSelector = '#bhp-ab-gateway-desktop-atf-4 a:nth-child(' + (index + 1) + ') > #bnp-recs-card-title'
        const matches = document.querySelectorAll(idealSelector)
        console.log('  Ideal selector:', idealSelector)
        console.log('  Matches:', matches.length, matches[0] === elem ? '✅' : '❌')
        console.log('')
      })

      console.log('Expected behavior:')
      console.log('1. Use duplicate IDs with parent context')
      console.log('2. Avoid intermediate divs when possible')
      console.log('3. Only add nth-child when there are multiple siblings')
    }

    window.addEventListener('load', testSelectors)
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Filter Component</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function TestFilterComponent() {
      const [isExpanded, setIsExpanded] = useState(false);
      const [filters, setFilters] = useState({ state: ['created', 'ready'] });
      const [clickCount, setClickCount] = useState(0);

      const experimentStates = [
        { value: 'created', label: 'Draft' },
        { value: 'ready', label: 'Ready' },
        { value: 'running', label: 'Running' },
        { value: 'stopped', label: 'Stopped' }
      ];

      const toggleArrayFilter = (key, value) => {
        console.log('toggleArrayFilter called:', key, value);
        alert(`Filter clicked: ${key} = ${value}`);
        setClickCount(c => c + 1);
        
        const current = filters[key] || [];
        const newValue = current.includes(value)
          ? current.filter(v => v !== value)
          : [...current, value];
        
        setFilters({ ...filters, [key]: newValue });
        console.log('Filters updated:', { ...filters, [key]: newValue });
      };

      return (
        <div className="w-96 p-4 bg-white border rounded-lg shadow-lg">
          <h2 className="text-lg font-bold mb-4">Filter Test Component</h2>
          
          <div className="mb-4">
            <p className="text-sm text-gray-600 mb-2">Click count: {clickCount}</p>
            <p className="text-sm text-gray-600 mb-2">Active filters: {JSON.stringify(filters)}</p>
          </div>

          <button
            onClick={() => {
              console.log('Funnel button clicked, expanded:', isExpanded);
              setIsExpanded(!isExpanded);
            }}
            className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 mb-4"
            data-testid="filter-toggle"
          >
            {isExpanded ? 'Hide Filters' : 'Show Filters'}
          </button>

          {isExpanded && (
            <div className="border-t pt-4">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Experiment State
              </label>
              <div className="flex flex-wrap gap-2">
                {experimentStates.map(state => (
                  <button
                    key={state.value}
                    onClick={(e) => {
                      e.preventDefault();
                      e.stopPropagation();
                      console.log('Button clicked:', state.value);
                      toggleArrayFilter('state', state.value);
                    }}
                    onMouseDown={() => console.log('Mouse down:', state.value)}
                    onMouseUp={() => console.log('Mouse up:', state.value)}
                    className={`px-3 py-1 text-sm rounded-md transition-colors cursor-pointer ${
                      filters.state?.includes(state.value)
                        ? 'bg-blue-100 text-blue-700'
                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                    }`}
                    data-filter-button="true"
                    data-filter-value={state.value}
                  >
                    {state.label}
                  </button>
                ))}
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<TestFilterComponent />, document.getElementById('root'));
  </script>
</body>
</html>
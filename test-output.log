ğŸš€ Starting global test setup...
âœ… Extension already built
âš ï¸  Note: Using existing build. Delete build/chrome-mv3-dev/manifest.json to force rebuild.
âœ… Copied seed.html to build directory
âœ… Copied seed.js to build directory
âœ… Copied local-test-page.html to build directory
âœ… Loaded environment variables from .env.local
âœ… API credentials found in environment
âœ… Global setup completed successfully
---

Running 1 test using 1 worker

Extension ID: elelnihlihbhpkobodjiodoefdjpdcjp
âœ… Test page loaded (test mode enabled)

ğŸ“‚ STEP 1: Injecting sidebar
âœ… Sidebar visible

ğŸ“‹ STEP 2: Creating new experiment
  Clicked Create New Experiment button
  Selected "From Scratch"
  Filled experiment name: Variable Sync Test 1760105169742
  Selecting Unit Type...
  Selected unit type
  Selecting Application...
  Selected application
âœ… Experiment form filled

ğŸ’‰ STEP 3: Adding injection code
  Expanded Custom Code Injection section
  Clicked Start of <head> card
  Code editor container visible
  CodeMirror editor visible
  Typed injection code
  Saved injection code
âœ… Injection code added
  Waited for injection code to sync

ğŸ¨ STEP 4: Adding DOM changes via Visual Editor
  Launched Visual Editor
  Visual Editor active
  Making text change...
  Text change made
  Saved VE changes
âœ… DOM changes added

ğŸ”— STEP 5: Adding URL filter
  Expanded URL Filtering section
  Selected simple URL filter mode
  Added URL filter pattern: /test/*
âœ… URL filter configured

ğŸ” STEP 6: Verifying initial state (before custom variable)
  â„¹ï¸  __inject_html and __dom_changes are special fields, not regular variables
  Opened Variant Config editor
  Variant config JSON preview (first 500 chars):
{  "__inject_html": {    "headStart": "<script>console.log(\"Test injection code!\")</script></script>"  },  "__dom_changes": {    "changes": [      {        "selector": "#test-title",        "type": "text",        "value": "Modified by VE!",        "enabled": true      }    ],    "urlFilter": {      "include": [        "/test/*"      ],      "mode": "simple",      "matchType": "path"    }  }}
  âœ“ __inject_html field present: true
  âœ“ __dom_changes field present: true
  âœ“ DOM changes content present: true
  âœ“ URL filter present: true
âœ… Initial state verified - all three elements present

â• STEP 7: Adding custom variable
  Clicked Add Variable button
  Typed variable name: hello
  Typed variable value: there
  Verifying inputs - name: "hello", value: "there"
  Saved custom variable
âœ… Custom variable added

ğŸ” STEP 8: CRITICAL VERIFICATION - Checking if data was preserved

  ğŸ”¬ Checking for all data in Config editor...
  âœ“ Custom variable "hello" present: true
  Opened Variant Config editor
  âœ“ Custom variable "hello" in config: true
  âœ“ __inject_html field in config: true
  âœ“ __dom_changes field in config: true
  âœ“ DOM changes content present: true
  âœ“ URL filter present: true

âœ… CRITICAL TEST PASSED!
  All data preserved after adding custom variable:
    âœ“ __inject_html (in full config JSON)
    âœ“ __dom_changes with VE changes and URL filter (in full config JSON)
    âœ“ "hello"="there" custom variable

â• STEP 9: Adding second custom variable to double-check
  Added second variable: foo = "bar"
  âœ“ hello: "there" - true
  âœ“ foo: "bar" - true
  âœ“ All variables in config - true
  âœ“ DOM changes in config - true

âœ… Second variable test passed - all data still preserved!

ğŸ‰ ALL TESTS PASSED!
  The sync feedback loop bug is FIXED!
  âœ“ __inject_html preserved when adding variables (visible in full config)
  âœ“ __dom_changes preserved when adding variables (visible in full config)
  âœ“ URL filters preserved when adding variables
  âœ“ Custom variables correctly added and visible
  âœ“  1 [chromium] â€º tests/e2e/variable-sync.spec.ts:45:7 â€º Variable Sync - __inject_html and DOM Changes Preservation â€º Should preserve __inject_html and DOM changes when adding custom variables (23.0s)

  1 passed (23.4s)

To open last HTML report run:
[36m[39m
[36m  npx playwright show-report[39m
[36m[39m

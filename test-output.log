🚀 Starting global test setup...
✅ Extension already built
⚠️  Note: Using existing build. Delete build/chrome-mv3-dev/manifest.json to force rebuild.
✅ Copied seed.html to build directory
✅ Copied local-test-page.html to build directory
✅ Loaded environment variables from .env.local
✅ API credentials found in environment
✅ Global setup completed successfully
---

Running 1 test using 1 worker

✅ Test page loaded (test mode enabled)
Extension ID: elelnihlihbhpkobodjiodoefdjpdcjp

📂 STEP 1: Injecting sidebar
✅ Sidebar visible

⚙️ STEP 2: Navigating to Settings
[CONSOLE] log: [SettingsView] checkAuthStatus called with endpoint: https://demo-2.absmartly.com/v1
[CONSOLE] log: [SettingsView] Sending CHECK_AUTH message...
[CONSOLE] log: [SettingsView] CHECK_AUTH response received: {success: false, error: Not authenticated}
[CONSOLE] log: [SettingsView] checkAuthStatus finally block - setting checkingAuth to false
✅ Settings page loaded

🔑 STEP 3: Configuring API Key authentication
  ✓ Selected API Key authentication method
  ✓ Filled endpoint
  ✓ Filled API key
  🔄 Testing authentication before saving...
[CONSOLE] log: [SettingsView] checkAuthStatus called with endpoint: https://demo-2.absmartly.com/v1
[CONSOLE] log: [SettingsView] Sending CHECK_AUTH message...
  ✓ Clicked Refresh button
  📸 Debug screenshot saved after refresh
  Debug: auth-user-info visible? [33mfalse[39m
  Debug: auth-not-authenticated visible? [33mfalse[39m
  ✘  1 [chromium] › tests/e2e/settings-auth.spec.ts:46:7 › Settings Authentication Tests › should show authenticated user data with API Key authentication (2.5s)


  1) [chromium] › tests/e2e/settings-auth.spec.ts:46:7 › Settings Authentication Tests › should show authenticated user data with API Key authentication › Configure API Key authentication and test BEFORE saving 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBeTruthy[2m()[22m

    Received: [31mfalse[39m

      133 |       console.log('  Debug: auth-not-authenticated visible?', isNotAuthVisible)
      134 |
    > 135 |       expect(hasUserInfoBeforeSave).toBeTruthy()
          |                                     ^
      136 |       console.log('  ✅ Shows authenticated state BEFORE saving!')
      137 |
      138 |       // Now save settings
        at /Users/joalves/git_tree/absmartly-browser-extension/tests/e2e/settings-auth.spec.ts:135:37
        at /Users/joalves/git_tree/absmartly-browser-extension/tests/e2e/settings-auth.spec.ts:84:5

  1 failed
    [chromium] › tests/e2e/settings-auth.spec.ts:46:7 › Settings Authentication Tests › should show authenticated user data with API Key authentication 

To open last HTML report run:
[36m[39m
[36m  npx playwright show-report[39m
[36m[39m

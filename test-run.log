
> absmartly-browser-extension@0.0.1 test:e2e
> playwright test visual-editor-complete.spec.ts

ğŸš€ Starting global test setup...
âœ… Extension already built
âš ï¸  Note: Using existing build. Delete build/chrome-mv3-dev/manifest.json to force rebuild.
âœ… Copied seed.html to build directory
âœ… Copied local-test-page.html to build directory
âœ… Loaded environment variables from .env.local
âœ… API credentials found in environment
âœ… Global setup completed successfully
---

Running 1 test using 1 worker

  ğŸ“ [log] [ABsmartly] Content script executing - TOP OF FILE
  ğŸ“ [log] [ABsmartly] Content script marker set: true
âœ… Test page loaded (test mode enabled)
  ğŸ“‹ Console messages so far: 3
Extension ID: elelnihlihbhpkobodjiodoefdjpdcjp

ğŸ“‚ STEP 1: Injecting sidebar
âœ… Sidebar visible

ğŸ“‹ STEP 2: Creating new experiment
  Dispatched click event to Create New Experiment button
  Selecting "From Scratch" option...
  âœ“ Selected "From Scratch" option
  Filled experiment name: E2E Test Experiment 1759577454661
  ğŸ“ [log] [ABsmartly] Message listener called! Message type: ABSMARTLY_PREVIEW
  Selecting Unit Type...
  âœ“ Unit types loaded
  âœ“ Selected unit type
  Selecting Applications...
  âœ“ Clicked applications field
  âœ“ Applications loaded in dropdown
  âœ“ Selected application: Wwww
âœ… Experiment form filled with required fields
ğŸ¨ STEP 3: Clicking Visual Editor button
  âœ“ Visual Editor button is enabled (form validation complete)
  âœ“ Waited for React handlers to attach
  âœ“ Brought test page to front
  ğŸ“ [log] [DOMChanges] HANDLER CALLED - about to query tabs
  ğŸ“ [log] [DOMChanges] Initial tabs query result: 1 tabs
  ğŸ“ [log] [DOMChanges] Using tab ID: 544484408
  ğŸ“ [log] [ABsmartly] Message listener called! Message type: CHECK_VISUAL_EDITOR_ACTIVE
  ğŸ“ [log] [ABsmartly] Message listener called! Message type: SET_VISUAL_EDITOR_STARTING
  âœ“ Dispatched click event to Visual Editor button
  ğŸ“ [log] [DOMChanges] About to send START_VISUAL_EDITOR, tabs[0]?.id: 544484408
  ğŸ“ [log] [ABsmartly] Message listener called! Message type: ABSMARTLY_PREVIEW
  ğŸ“ [log] [DOMChanges] Sending START_VISUAL_EDITOR to tab: 544484408
  ğŸ“ [log] [ABsmartly] Message listener called! Message type: START_VISUAL_EDITOR
  ğŸ“ [log] [ABsmartly] Received START_VISUAL_EDITOR message: {"type":"START_VISUAL_EDITOR","variantName":"Control","experimentName":"E2E Test Experiment 1759577454661","changes":[]}
  ğŸ“ [log] [ABsmartly] startVisualEditor called with config: {"variantName":"Control","experimentName":"E2E Test Experiment 1759577454661","changes":[]}
  ğŸ“ [log] [ABsmartly] startVisualEditor completed with result: {"success":true}
  â³ Waited 3s after VE button click
  ğŸ“‹ Captured 147 console messages
  ğŸ“‹ Content script/background messages: 10
  Messages:
    [log] [ABsmartly] Content script executing - TOP OF FILE
    [log] [ABsmartly] Content script marker set: true
    [log] [ABsmartly] Message listener called! Message type: ABSMARTLY_PREVIEW
    [log] [ABsmartly] Message listener called! Message type: CHECK_VISUAL_EDITOR_ACTIVE
    [log] [ABsmartly] Message listener called! Message type: SET_VISUAL_EDITOR_STARTING
    [log] [ABsmartly] Message listener called! Message type: ABSMARTLY_PREVIEW
    [log] [ABsmartly] Message listener called! Message type: START_VISUAL_EDITOR
    [log] [ABsmartly] Received START_VISUAL_EDITOR message: {"type":"START_VISUAL_EDITOR","variantName":"Control","experimentName":"E2E Test Experiment 1759577454661","changes":[]}
    [log] [ABsmartly] startVisualEditor called with config: {"variantName":"Control","experimentName":"E2E Test Experiment 1759577454661","changes":[]}
    [log] [ABsmartly] startVisualEditor completed with result: {"success":true}
  â³ Waiting for VE banner to appear...
  ğŸ“‹ Total messages captured so far: 147
âœ… Visual editor active
  Screenshot saved: sidebar-after-ve-launch.png

ğŸš« STEP 3.5: Testing VE protection - all buttons should be disabled
  Found 2 Visual Editor buttons
  Button 0 disabled: true, title: "Visual Editor is already active for this variant"
  Button 1 disabled: true, title: "Visual Editor is active for variant "Control""
  âœ… All VE buttons correctly disabled when VE is active

ğŸ§ª STEP 4: Testing visual editor context menu actions
  Testing: Edit Text on #test-paragraph
  âœ“ Edit Text works
  Testing: Hide on #button-1
  âœ“ Hide works
  Testing: Delete on #button-2
  âœ“ Delete works
  Testing: Move up on #item-2
  âœ“ Move up works
  Testing: Edit HTML on #test-container
  âœ“ CodeMirror editor appeared
  âœ“ CodeMirror syntax highlighting: true
  âœ“ Updated HTML via CodeMirror
  Looking for Save button...
  Clicking Save button with JavaScript click...
  Clicked Save button
  Editor closed
  âœ“ Edit HTML with CodeMirror works
âœ… Visual editor actions tested (Edit Text, Hide, Delete, Move up, Edit HTML)

âœ“ Verifying DOM changes were actually applied...
  Applied changes: {
  paragraphText: [32m'Modified text!'[39m,
  button1Display: [32m'none'[39m,
  button2Display: [32m'none'[39m,
  testContainerHTML: [32m'<h2>HTML Edited!</h2><p>New paragraph content</p><p></p>'[39m
}
  âœ“ Text change applied: paragraph text is "Modified text!"
  âœ“ Hide change applied: button-1 is display:none
  âœ“ Delete change applied: button-2 is hidden (display:none)
  âœ“ HTML change applied: test-container has new HTML
âœ… All DOM changes verified and applied correctly

ğŸ”„ Testing undo/redo with multiple changes to same element...
  ğŸ“ Current text: "Modified text!"
  âœï¸  Making change 1: "Undo test 1"
  âœ“ Change 1 applied: "Undo test 1" (trackChange: null, undoAction: null)
  âœï¸  Making change 2: "Undo test 2"
  âœ“ Change 2 applied: "Undo test 2" (trackChange: null, undoAction: null)
  âœï¸  Making change 3: "Undo test 3"
  âœ“ Change 3 applied: "Undo test 3" (trackChange: null, undoAction: null)
  âœ“ Final text after changes: "Undo test 3"

  âª Testing undo with individual change tracking...
  âœ“ Undo 1: Text is now "Undo test 2"
  âœ“ Undo 2: Text is now "Undo test 1"
  âœ“ Undo 3: Text is now "Modified text!"

  â© Testing redo...
  âœ“ Redo 1: Text is now "Undo test 1"
  âœ“ Redo 2: Text is now "Undo test 2"
  âœ“ Redo 3: Text is now "Undo test 3"

âœ… Undo/redo with individual change tracking working correctly!
  â€¢ Each change tracked individually for granular undo/redo
  â€¢ 3 undos: "Undo test 3" -> "Undo test 2" -> "Undo test 1" -> "Modified text!"
  â€¢ 3 redos: "Modified text!" -> "Undo test 1" -> "Undo test 2" -> "Undo test 3"

ğŸ”˜ Testing undo/redo button states...
  âª Undoing all changes to test undo button disabled state...
  âœ“ Undo button became disabled after 8 undos
  âœ“ Undo button is disabled when no more changes to undo

  â© Redoing all changes to test redo button disabled state...
  âœ“ Redo button became disabled after 8 redos
  âœ“ Redo button is disabled when no more changes to redo

âœ… Undo/redo button states test PASSED!
  â€¢ Undo button disabled after 8 undos (no more history)
  â€¢ Redo button disabled after 8 redos (caught up to current state)

ğŸ’¾ STEP 5: Clicking Save button...
âœ… Save button clicked

â³ STEP 6: Waiting for sidebar to update after visual editor closes...
  ğŸ“ [log] [ABsmartly] Message listener called! Message type: ABSMARTLY_PREVIEW
  âœ˜  1 [chromium] â€º tests/e2e/visual-editor-complete.spec.ts:104:7 â€º Visual Editor Complete Workflow â€º Complete workflow: sidebar â†’ experiment â†’ visual editor â†’ actions â†’ save â†’ verify (20.2s)


  1) [chromium] â€º tests/e2e/visual-editor-complete.spec.ts:104:7 â€º Visual Editor Complete Workflow â€º Complete workflow: sidebar â†’ experiment â†’ visual editor â†’ actions â†’ save â†’ verify â€º Wait for sidebar to update 

    [31mTest timeout of 20000ms exceeded.[39m

    Error: page.waitForTimeout: Target page, context or browser has been closed

      753 |       // The changes should be visible in the variant's DOM Changes section
      754 |       // Give it extra time for React to re-render the inline editor with the changes
    > 755 |       await testPage.waitForTimeout(2000)
          |                      ^
      756 |
      757 |       await debugWait()
      758 |     })
        at /Users/joalves/git_tree/absmartly-browser-extension/tests/e2e/visual-editor-complete.spec.ts:755:22
        at /Users/joalves/git_tree/absmartly-browser-extension/tests/e2e/visual-editor-complete.spec.ts:749:16

  1 failed
    [chromium] â€º tests/e2e/visual-editor-complete.spec.ts:104:7 â€º Visual Editor Complete Workflow â€º Complete workflow: sidebar â†’ experiment â†’ visual editor â†’ actions â†’ save â†’ verify 

To open last HTML report run:
[36m[39m
[36m  npx playwright show-report[39m
[36m[39m

ðŸš€ Starting global test setup...
âœ… Extension already built
âš ï¸  Note: Using existing build. Delete build/chrome-mv3-dev/manifest.json to force rebuild.
âœ… Copied seed.html to build directory
âœ… Copied seed.js to build directory
âœ… Copied local-test-page.html to build directory
âœ… Loaded environment variables from .env.dev.local
âœ… API credentials found in environment
âœ… Global setup completed successfully
---

Running 1 test using 1 worker

âœ… Test page loaded (test mode enabled)
  ðŸ“‹ Console messages so far: 0
Extension ID: hmdfdmlfegajkklhbiijdpkdbaccnplj

ðŸ“‚ STEP 1: Injecting sidebar
  [Test] Content script not loaded, injecting now...
  [Test] âœ… Content script injected
âœ… Sidebar visible

ðŸ“‹ STEP 2: Creating new experiment
  Dispatched click event to Create New Experiment button
  Selecting "From Scratch" option...
  âœ“ Selected "From Scratch" option
  Filled experiment name: E2E Test Experiment 1761059381773
  Selecting Unit Type...
  Selecting Unit Type...
  âœ“ Unit type select is enabled
  âœ“ Clicked unit type trigger
  âœ“ Selected unit type
  Selecting Applications...
  âœ“ Clicked applications trigger
  âœ“ Selected application
âœ… Experiment form filled with required fields
ðŸŽ¨ STEP 3: Clicking Visual Editor button
  âœ“ Visual Editor button is enabled (form validation complete)
  âœ“ Waited for React handlers to attach
  âœ“ Brought test page to front
  âœ“ Dispatched click event to Visual Editor button
  â³ Waited 3s after VE button click
  ðŸ“‹ Captured 136 console messages
  ðŸ“‹ Content script/background messages: 2
  Messages:
    [log] [ABsmartly] Content script executing - TOP OF FILE
    [log] [ABsmartly] Content script marker set: true
  âŒ Found 3 error messages:
    - WebSocket connection to 'ws://localhost:1815/' failed: Error in connection establishment: net::ERR_CONNECTION_REFUSED
    - WebSocket connection to 'ws://localhost:1815/' failed: Error in connection establishment: net::ERR_CONNECTION_REFUSED
    - Failed to save development environment: Error: Cannot access contents of url "file:///Users/joalves/git_tree/ext-dev6-refactor-sdk-plugin/tests/test-pages/visual-editor-test.html?use_shadow_dom_for_visual_editor_context_menu=0". Extension manifest must request permission to access this host.
  â³ Waiting for VE banner to appear...
  ðŸ“‹ Total messages captured so far: 136
  Screenshot saved: before-ve-banner-wait.png
  âœ˜  1 [chromium] â€º tests/e2e/visual-editor-complete.spec.ts:82:7 â€º Visual Editor Complete Workflow â€º Complete workflow: sidebar â†’ experiment â†’ visual editor â†’ actions â†’ save â†’ verify (18.5s)


  1) [chromium] â€º tests/e2e/visual-editor-complete.spec.ts:82:7 â€º Visual Editor Complete Workflow â€º Complete workflow: sidebar â†’ experiment â†’ visual editor â†’ actions â†’ save â†’ verify â€º Activate Visual Editor 

    TimeoutError: locator.waitFor: Timeout 15000ms exceeded.
    Call log:
    [2m  - waiting for locator('#absmartly-visual-editor-banner-host') to be visible[22m


      251 |
      252 |     // Wait for VE banner to appear (more reliable than checking window variable)
    > 253 |     await testPage.locator('#absmartly-visual-editor-banner-host').waitFor({ state: 'visible', timeout: 15000 })
          |                                                                    ^
      254 |     console.log('âœ… Visual editor active')
      255 |
      256 |       // Take screenshot to see sidebar state after VE activates
        at /Users/joalves/git_tree/ext-dev6-refactor-sdk-plugin/tests/e2e/visual-editor-complete.spec.ts:253:68
        at /Users/joalves/git_tree/ext-dev6-refactor-sdk-plugin/tests/e2e/visual-editor-complete.spec.ts:178:5

  1 failed
    [chromium] â€º tests/e2e/visual-editor-complete.spec.ts:82:7 â€º Visual Editor Complete Workflow â€º Complete workflow: sidebar â†’ experiment â†’ visual editor â†’ actions â†’ save â†’ verify 

To open last HTML report run:
[36m[39m
[36m  npx playwright show-report[39m
[36m[39m
